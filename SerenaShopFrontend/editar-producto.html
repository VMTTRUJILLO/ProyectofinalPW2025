<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Producto - Admin</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

    <header class="header">
        <h1>Panel Admin - Editar Producto</h1>
        <a href="admin.html" class="btn-volver">Volver</a>
    </header>

    <main class="admin-container">

                <form id="editarProductoForm" class="admin-form">
                    <h2>Editar Producto</h2>

                    <input type="hidden" id="productoId"> 

                    <img id="preview" class="preview-img" alt="Preview">

                    <label for="nombre">Nombre:</label>
                    <input type="text" id="nombre" required>

                    <label for="productoCategoria" class="form-label">Categoría</label>
                <select class="form-select" id="productoCategoria" name="idCategoria" required>
                    <option value="" disabled selected>Selecciona una categoría</option>
                    <option value="1">Aretes</option>
                    <option value="2">Earcuff</option>
                    <option value="3">Pulseras</option>
                    <option value="4">Cadenas</option>
                    <option value="5">Chocker</option>
                    <option value="6">Tobillera</option>
                    <option value="7">Anillos</option>
                </select>
            

                    <label for="precio">Precio:</label>
                    <input type="number" id="precio" step="0.01" required>

                    <label for="stock">Stock:</label>
                    <input type="number" id="stock" required>

                    <label for="disponible">Disponible:</label>
                    <select id="disponible" required>
                        <option value="true">Sí</option>
                        <option value="false">No</option>
                    </select>

                    <label for="imagen">Nombre archivo imagen (.jpeg, .jpg):</label>
                    <input type="text" id="imagen" required>

                    <button type="submit" class="btn-primary">Guardar Cambios</button>
                </form>

    </main>

    <script src="./js/config.js"></script>
    <script src="./js/api.js"></script>
    <script src="./js/productos.js"></script>
    <script>
        

        // Obtener ID desde parámetros de URL
        const params = new URLSearchParams(window.location.search);
        const id = params.get("id");

        if (!id) {
            alert("No se recibió ID del producto");
            window.location.href = "admin.html";
        }

        const nombreEl = document.getElementById("nombre");
        const descripcionEl = document.getElementById("descripcion");
        const precioEl = document.getElementById("precio");
        const stockEl = document.getElementById("stock");
        const imagenEl = document.getElementById("imagen");
        const preview = document.getElementById("preview");

        async function cargarProducto() {
            const producto = await api.getProductoById(id);

            nombreEl.value = producto.nombre;
            precioEl.value = producto.precio;
            stockEl.value = producto.stock;
            imagenEl.value = producto.imagen;

            preview.src = `/img/${producto.imagen}`;
        }

        cargarProducto();

        document.getElementById("editarProductoForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const actualizado = {
                id: parseInt(id),
                nombreProducto: nombreEl.value,
                precio: parseFloat(precioEl.value),
                stock: parseInt(stockEl.value),
                imagen: imagenEl.value
            };

            try {
                await api.updateProducto(actualizado);
                alert("Cambios guardados");
                window.location.href = "admin.html";
            } catch (error) {
                console.error(error);
                alert("Error actualizando producto");
            }
        });

        // Actualización en vivo de la imagen
        imagenEl.addEventListener("input", () => {
            preview.src = `/img/${imagenEl.value}`;
        });
    </script>

</body>
</html>